<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=0">
    <title>index</title>

    <!-- import element CSS -->
    <link href="https://cdn.bootcss.com/element-ui/2.12.0/theme-chalk/index.css" rel="stylesheet">
    <!-- import github-markdown CSS -->
    <link href="https://cdn.bootcss.com/github-markdown-css/3.0.1/github-markdown.min.css" rel="stylesheet">
    <!-- import 代码高亮 CSS -->
    <link href="https://cdn.bootcss.com/prism/1.17.1/themes/prism-okaidia.min.css" rel="stylesheet">
    <!-- import 代码行号 CSS -->
    <link href="https://cdn.bootcss.com/prism/1.17.1/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">
    <!-- import 代码块工具条 CSS -->
    <link href="https://cdn.bootcss.com/prism/1.17.1/plugins/toolbar/prism-toolbar.min.css" rel="stylesheet">
    <!-- import header CSS -->
    <link href="/header.css" rel="stylesheet">
    <style>
        .markdown-body {
            box-sizing: border-box;
            min-width: 200px;
            max-width: 980px;
            margin: 0 auto;
            padding: 45px;
        }

        /*设置代码块中的字体大小*/
        code[class*=language-], pre[class*=language-] {
            font-size: 13px;
        }

        @media (max-width: 767px) {
            .markdown-body {
                padding: 15px;
            }
        }

        /*将级联选择器的高度变高*/
        .el-cascader-menu__wrap {
            height: 325px;
        }

        /*设置抽屉的body的滚动条*/
        .el-drawer__body {
            -webkit-box-flex: 1;
            flex: 1;
            overflow: auto;
        }

        /*设置抽屉的header的间距*/
        .el-drawer__header {
            margin-bottom: 10px;
            padding: 10px 10px 0;
        }
        .el-drawer__body {
            -webkit-box-flex: 1;
            flex: 1;
            overflow: auto;
            margin-bottom: 20px;
        }

        .header{
            display: block;
        }

        .header:hover  {
            background-color:yellow;
        }

        /*将最后的面包屑中的样式去除*/
        .el-breadcrumb__item:last-child .el-breadcrumb__inner a{
            font-weight: 700;
            color: #606266;
            cursor: pointer;
        }
        .el-breadcrumb__item:last-child .el-breadcrumb__inner a:hover{
            font-weight: 700;
            color: #409EFF;
            cursor: pointer;
        }


</style>
</head>
<body >
    <div id="app" class="markdown-body">

        <el-row>
            <el-col :xs="24" :span="12">
                <el-breadcrumb>
                    <el-breadcrumb-item>
                        <el-link href="/">首页</el-link>
                    </el-breadcrumb-item>
                    <el-breadcrumb-item v-for="item in pathArr">
                        <el-link :href="item.url">{{item.value}}</el-link>
                    </el-breadcrumb-item>
                </el-breadcrumb>
            </el-col>
            <el-col :xs="0" :span="12">
                <el-breadcrumb separator="|">
                    <el-breadcrumb-item>
                        <el-link @click="outline_drawer=true">大纲</el-link>
                    </el-breadcrumb-item>
                    <el-breadcrumb-item>
                        <el-link @click="dir_drawer=true">搜索</el-link>
                    </el-breadcrumb-item>
                </el-breadcrumb>
            </el-col>
        </el-row>


        <!--大纲-->
        <el-drawer
                id="header"
                title="大纲"
                :visible.sync="outline_drawer"
                direction="ltr"
                :size="outline_size">

            <div style="margin: 10px 10px">
                <el-link v-for="(item,index) in headerOptions"
                         :key="index"
                         :class="'header side-header'+item.levle"
                         :href="'#'+item.value"
                         :type="item.label.indexOf('（***）')==-1?'default':'danger'">
                    {{ item.label.indexOf('（***）')==-1?item.label:item.label.substring(0,item.label.length-5) }}
                </el-link>
            </div>
        </el-drawer>


        <!--目录结构-->
        <el-drawer
                title="全能搜索"
                direction="ttb"
                :visible.sync="dir_drawer"
                size="45%">
            <div>
                <el-link>目录搜索</el-link>
            </div>
            <el-cascader
                    placeholder="搜索目录"
                    :options="blogOptions"
                    :filter-method="filter"
                    :props="blogProps"
                    @change="nodeClick"
                    clearable
                    :debounce="150"
                    filterable>
            </el-cascader>

            <div>
                <el-link>当前标题搜索</el-link>
            </div>

            <el-select v-model="headerValue" clearable filterable placeholder="请选择" @change="headerNodeClick">
                <el-option
                        v-for="(item,index) in headerOptions"
                        :key="index"
                        :label="item.label"
                        :value="item.value">
                </el-option>
            </el-select>


        </el-drawer>


        <!-- 博客内容（必须要放在最下面，不然会影响elementUI解析） -->
        <div id="blog">
            ${blog!}
        </div>

    </div>
</body>
<!--vue.js-->
<!--<script src="https://cdn.bootcss.com/vue/2.6.10/vue.min.js"></script>-->
<script src="https://cdn.bootcss.com/vue/2.6.10/vue.common.dev.js"></script><!--开发的时候使用生产模式-->
<!--axios.js-->
<script src="https://cdn.bootcss.com/axios/0.19.0-beta.1/axios.min.js"></script>
<!--element.js-->
<script src="https://cdn.bootcss.com/element-ui/2.12.0/index.js"></script>
<!--代码高亮js-->
<script src="https://cdn.bootcss.com/prism/1.17.1/components/prism-core.min.js"></script>
<script src="https://cdn.bootcss.com/prism/1.17.1/plugins/autoloader/prism-autoloader.min.js"></script>
<!--代码行号js-->
<script src="https://cdn.bootcss.com/prism/1.17.1/plugins/line-numbers/prism-line-numbers.min.js"></script>
<!--代码工具条js-->
<script src="https://cdn.bootcss.com/prism/1.17.1/plugins/toolbar/prism-toolbar.min.js"></script>
<!--代码复制js-->
<script src="https://cdn.bootcss.com/prism/1.17.1/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
<script>
    //全局快捷键
    var q_key=81;
    var Q_key=113;
    var w_key=87;
    var W_key=119;
    document.onkeypress=function (event) {
        var key = event.keyCode;

        console.log(key,event.shiftKey,event.altKey,event.ctrlKey)
        if(event.shiftKey && (key==q_key || key==Q_key)){
            vue.outline_drawer=!vue.outline_drawer;
            event.preventDefault();//阻止默认事件
        }else if(event.shiftKey && (key==w_key || key==W_key)){
            vue.dir_drawer=!vue.dir_drawer;
            event.preventDefault();//阻止默认事件
        }
    }

    var vue=new Vue({
        el: '#app',
        data: {
            outline_drawer: false,
            dir_drawer: false,
            blogProps: {
                value:'url',
                label:'name',
                children:'child',
            },
            headerValue:'',
            blogOptions: [],
            headerOptions:[],
            headerTree:{},
            outline_size: window.innerWidth<576==true?'60%':'20%',
            pathArr: [],
        },
        created:function(){
            var _this=this;
            //获取目录数据
            axios.get('/getDir')
                .then(function (response) {
                    _this.blogOptions=response.data;
                });
            //获取header数据
            var headers=document.getElementsByClassName("header");
            for(var i=0;i<headers.length;i++){
                var header=headers[i];
                //添加标题搜索数据
                _this.headerOptions.push({
                    value:header.textContent,
                    label:header.textContent,
                    levle:header.tagName.charAt(1)
                });
            }
            //获取面包屑数据
            var path=decodeURI(window.location.pathname);
            var arr=path.substring(6).split("/");
            var buff="/blog";
            for(var i=0;i<arr.length;i++){
                var item=arr[i];
                buff+="/"+item;
                //最后一个不需要生成链接
                if(i==arr.length-1){
                    buff="javascrpit:void(0);";
                }
                this.pathArr.push({
                    value:item,
                    url:buff
                });
            }
        },
        methods:{
            filter:function (node,keyword) {
                //过滤不区分大小写
                if(node.label.toLowerCase().indexOf(keyword.toLowerCase())!=-1){
                    return true;
                }
            },
            nodeClick:function (node) {
                window.location="/blog"+node[node.length-1];
            },
            //标题跳转
            headerNodeClick:function (node) {
                window.location="#"+node;
                this.dir_drawer=false;
            },

        }

    })




    //手机端工具类
    const DomUtils={
        isMobile(){
            return window.innerWidth<576;
        },
        addGestureEvent(callback){
            let startPoint=null,endPoint=null;
            document.addEventListener("touchstart",function (event) {
                let touch = event.targetTouches[0];
                startPoint={
                    x:touch.clientX,
                    y:touch.clientY
                };
            });
            document.addEventListener("touchend",function (event) {
                //防止其他有滚动条的元素扰乱滑动监听
                if(event.target.tagName==="PRE" || event.target.tagName==="SPAN" || event.target.tagName==="CODE")return;

                let touch = event.changedTouches[0];
                endPoint={
                    x:touch.clientX,
                    y:touch.clientY
                };
                //计算手势
                let xDistance=endPoint.x-startPoint.x;
                let yDistance=endPoint.y-startPoint.y;
                if(Math.abs(xDistance)>Math.abs(yDistance)){
                    if(Math.abs(xDistance)>window.innerWidth*(1/5.0)){
                        callback(xDistance>0?"right":"left");
                    }
                }else{
                    if(Math.abs(yDistance)>window.innerHeight*(1/3.0)){
                        callback(yDistance>0?"down":"top");
                    }
                }
            })
        }
    }


    //手机端监听左右滑动事件
    if(DomUtils.isMobile()){
        DomUtils.addGestureEvent(function (event) {
            if(event==="right"){
                vue.outline_drawer=true;
            }else if(event==="left"){
                console.log("left")
                vue.dir_drawer=true;
            }
        })
    }
</script>
</html>